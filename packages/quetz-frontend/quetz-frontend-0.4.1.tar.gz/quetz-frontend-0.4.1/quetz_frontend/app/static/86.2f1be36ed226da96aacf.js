"use strict";(self["webpackChunk_quetz_frontend_main_app"]=self["webpackChunk_quetz_frontend_main_app"]||[]).push([[86],{40086:(e,a,t)=>{t.r(a);t.d(a,{CommandIDs:()=>Z,default:()=>ae});var n=t(85168);var r=t(79450);var s=t(18470);var l=t(28390);var c=t(4496);var o=t(2411);var i=t(30325);var m=t(5089);var p=t(34494);var d=t(18303);var h=t(98078);var u=t(98635);var g=t(80268);class E extends o.PureComponent{constructor(e){super(e);this.onSearch=e=>{this.setState({searchText:e})};this.state={channels:null,searchText:""}}render(){const{searchText:e}=this.state;const a=[{text:"Home",onClick:()=>{this.props.router.navigate("/")}},{text:"Channels"}];const t=h.ServerConnection.makeSettings();const n=d.URLExt.join(t.baseUrl,"/api/paginated/channels");return o.createElement(o.Fragment,null,o.createElement(u.Breadcrumbs,{items:a}),o.createElement("h2",{className:"heading2"},"Channels"),o.createElement(p.Search,{className:"channels-search",onInput:e=>{this.onSearch(e.target.value)},placeholder:"Search"}),o.createElement(g.PaginatedList,{url:n,params:{q:e},columns:b(),to:e=>{this.props.router.navigate(`/channels/${e.name}`)}}))}}const f=E;const b=()=>[{Header:"",accessor:"name",Cell:({row:e})=>{const[a,t]=o.useState(null);return o.createElement(o.Fragment,null,o.createElement("span",{ref:e=>{t(e)}},o.createElement(m.FontAwesomeIcon,{icon:e.original.private?i.faUnlockAlt:i.faGlobeAmericas})),o.createElement(p.Tooltip,{anchorElement:a,position:"right"},e.original.private?"Private":"Public"))},width:5},{Header:"",accessor:"user.profile.name",Cell:({row:e})=>o.createElement("div",null,o.createElement("p",{className:"text"},e.original.name),o.createElement("p",{className:"minor-paragraph channel-list-description"},e.original.description)),width:45},{Header:"",accessor:"user.username",Cell:({row:e})=>(0,u.formatPlural)(e.original.packages_count,"package"),width:35},{Header:"",accessor:"role",Cell:({row:e})=>(0,u.formatPlural)(e.original.members_count,"member"),width:20}];var v=t(47);class k extends o.PureComponent{constructor(){super(...arguments);this.onCopy=e=>{console.log("Copied key: ",e)};this.onDelete=e=>{console.log("Deleted key: ",e)}}render(){const{apiKeyList:e,filters:a}=this.props;const t=a?(0,v.filter)(e,(e=>(0,v.some)(e.roles,a))):e;return o.createElement(g.Table,{columns:w({onCopy:this.onCopy,onDelete:this.onDelete}),data:t||[]})}}class C extends o.PureComponent{render(){const{filters:e}=this.props;const a=h.ServerConnection.makeSettings();const t=d.URLExt.join(a.baseUrl,"api/api-keys");return o.createElement(o.Fragment,null,o.createElement(u.FetchHoc,{url:t,loadingMessage:"Fetching list of API keys",genericErrorMessage:"Error fetching API keys"},(a=>o.createElement(k,{apiKeyList:a,filters:e}))))}}const I=C;const w=({onCopy:e,onDelete:a})=>[{Header:"API key",accessor:"key"},{Header:"Description",accessor:"description"},{Header:"Role",accessor:"roles[0].role"},{Header:"Actions",accessor:"actions",Cell:({row:t})=>o.createElement(o.Fragment,null,o.createElement(p.Button,{"aria-label":"Copy API key",title:"Copy API key",appearance:"stealth",onClick:()=>e(t.original.key)},o.createElement(m.FontAwesomeIcon,{icon:i.faCopy})),o.createElement(p.Button,{"aria-label":"Delete API key",title:"Delete API key",appearance:"stealth",onClick:()=>a(t.original.key)},o.createElement(m.FontAwesomeIcon,{icon:i.faTrash})))}];class x extends o.PureComponent{render(){const{channelId:e}=this.props;return o.createElement("div",{className:"padding"},o.createElement(I,{filters:{channel:e}}))}}const N=x;class y extends o.PureComponent{render(){const{channelId:e}=this.props;const a=h.ServerConnection.makeSettings();const t=d.URLExt.join(a.baseUrl,"/api/channels",e);return o.createElement(u.FetchHoc,{url:t,loadingMessage:"Fetching channel information",genericErrorMessage:"Error fetching channel information"},(e=>o.createElement("div",{className:"padding"},o.createElement("p",{className:"paragraph"},o.createElement(m.FontAwesomeIcon,{icon:e.private?i.faUnlockAlt:i.faGlobeAmericas}),"â€ƒ",e.private?"Private":"Public"),o.createElement("p",{className:"caption-inline"},"Description"),o.createElement("p",{className:"paragraph"},e.description||o.createElement("i",null,"No description available")),o.createElement("p",{className:"caption-inline"},"Mirror mode"),o.createElement("p",{className:"paragraph"},e.mirror_mode||o.createElement("i",null,"n/a")),o.createElement("p",{className:"caption-inline"},"Mirror channel URL"),o.createElement("p",{className:"paragraph"},e.mirror_channel_url||o.createElement("i",null,"n/a")),o.createElement("p",{className:"caption-inline"},"Size limit"),o.createElement("p",{className:"paragraph"},e.size_limit?(0,u.formatSize)(e.size_limit):o.createElement("i",null,"No size limit")))))}}const P=y;class S extends o.PureComponent{render(){const{channelId:e}=this.props;const a=h.ServerConnection.makeSettings();const t=d.URLExt.join(a.baseUrl,"/api/channels",e,"/members");return o.createElement(u.FetchHoc,{url:t,loadingMessage:"Fetching list of members",genericErrorMessage:"Error fetching members"},(e=>o.createElement("div",{className:"padding"},o.createElement(g.List,{columns:T(),data:e||[]}))))}}const _=S;const T=()=>[{Header:"",accessor:"name",Cell:({row:e})=>o.createElement("img",{src:e.original.user.profile.avatar_url,className:"profile-icon",alt:""}),width:10},{Header:"",accessor:"user.profile.name",width:40},{Header:"",accessor:"user.username",width:30},{Header:"",accessor:"role",width:20}];var H=t(65519);var $=t.n(H);const R=e=>{const[a,t]=o.useState(false);const n=()=>{t(true);setTimeout((()=>t(false)),1e3)};return o.createElement(m.FontAwesomeIcon,{className:"copy-button"+(e.size?` fa-${e.size}`:"")+(a?" shake":""),icon:i.faCopy,onClick:()=>{n();navigator.clipboard.writeText(e.copyText)}})};const A=R;class F extends o.PureComponent{constructor(){super(...arguments);this._platforms={linux:{faIconName:"linux",operatingSystems:[]},osx:{faIconName:"apple",operatingSystems:[]},win:{faIconName:"windows",operatingSystems:[]},other:{operatingSystems:[]}};this._fillPlatform=e=>{const a=e.split("-")[0];const t=a in this._platforms?a:"other";const n=this._platforms[t].operatingSystems.length==0;if(!this._platforms[t].operatingSystems.includes(e)){this._platforms[t].operatingSystems.push(e)}return n};this._formatPlatform=e=>{const a=e in this._platforms?e:"other";return o.createElement("div",null,o.createElement("div",{className:"package-files-row"},"faIconName"in this._platforms[a]&&o.createElement("i",{className:`fa fa-${this._platforms[a].faIconName} fa-3x`}),o.createElement("span",{className:"package-platform-list"},this._platforms[a].operatingSystems.map(((e,a)=>o.createElement("p",{key:`${e}_${a}`},e))))))}}render(){const{channel:e,selectedPackage:a}=this.props;const t=h.ServerConnection.makeSettings();const n=d.URLExt.join(t.baseUrl,"/api/paginated/channels",e,"/packages",a,"/versions");return o.createElement(u.FetchHoc,{url:n,loadingMessage:`Loading versions in ${a}`,genericErrorMessage:"Error fetching package versions information"},(r=>{if(r.result.length===0){return o.createElement("div",null,"No versions available for the package")}const s=[];r.result.forEach((e=>{const a=this._fillPlatform(e.platform);if(a){s.push(e)}}));return o.createElement(o.Fragment,null,o.createElement("div",{className:"package-row-flex"},s.map((e=>{const a=e.info;return o.createElement("div",{key:`${a.platform}_${a.version}`,className:"platform-item"},this._formatPlatform(a.platform),o.createElement("h4",{className:"section-heading"},"Package Info"),o.createElement("p",{className:"minor-paragraph"},o.createElement("b",null,"Arch"),": ",a.arch||"n/a",o.createElement("br",null),o.createElement("b",null,"Build"),": ",a.build||"n/a",o.createElement("br",null),o.createElement("b",null,"MD5"),": ",a.md5," ",o.createElement(A,{copyText:a.md5}),o.createElement("br",null),o.createElement("b",null,"Platform"),": ",e.platform,o.createElement("br",null),o.createElement("b",null,"Latest version"),": ",a.version),o.createElement("h4",{className:"section-heading"},"Dependencies"),o.createElement("p",{className:"minor-paragraph"},(0,v.map)(a.depends,((e,t)=>o.createElement("span",{key:`${a.arch}_${t}`,className:"tag"},e)))))}))),o.createElement("h4",{className:"section-heading"},"Install"),o.createElement("div",{className:"minor-paragraph package-install-command"},o.createElement("pre",null,"mamba install -c ",e," ",a),o.createElement(A,{copyText:`mamba install -c ${e} ${a}`,size:"lg"})),this.props.showVersionsList&&o.createElement(o.Fragment,null,o.createElement("h4",{className:"section-heading"},"History"),o.createElement(g.PaginatedTable,{url:n,enableSearch:false,columns:M(t.baseUrl)})))}))}}const U=F;const M=e=>[{Header:"Uploader",accessor:"uploader.name",Cell:({row:e})=>e.values["uploader.name"]},{Header:"Date",accessor:"time_created",Cell:({row:e})=>$()(e.values.time_created,{max:1,suffix:true})},{Header:"Filename",accessor:"filename",Cell:({row:a})=>o.createElement("a",{href:d.URLExt.join(e,`/get/${a.original.channel_name}/${a.original.info.subdir}/${a.values.filename}`),download:true},a.values.filename)},{Header:"Platform",accessor:"info.platform",Cell:({row:e})=>{const a=e.values["info.platform"];return a==="linux"?o.createElement("i",{className:"fa fa-linux fa-2x"}):a==="osx"?o.createElement("i",{className:"fa fa-apple fa-2x"}):a==="win"?o.createElement("i",{className:"fa fa-windows fa-2x"}):o.createElement("div",{className:"package-platform-noarch"},o.createElement("i",{className:"fa fa-linux"}),o.createElement("i",{className:"fa fa-apple"}),o.createElement("i",{className:"fa fa-windows"}))}},{Header:"Size",accessor:"info.size",Cell:({row:e})=>(0,u.formatSize)(e.values["info.size"])},{Header:"Version",accessor:"version",Cell:({row:e})=>e.values.version}];class L extends o.PureComponent{constructor(){super(...arguments);this.renderRowSubComponent=({row:e})=>{const{channelId:a}=this.props;const t=e.values.name;return o.createElement(U,{selectedPackage:t,channel:a})}}render(){const{channelId:e}=this.props;const a=h.ServerConnection.makeSettings();const t=d.URLExt.join(a.baseUrl,"/api/paginated/channels",e,"/packages");return o.createElement(g.PaginatedTable,{url:t,enableSearch:true,columns:D(e),renderRowSubComponent:this.renderRowSubComponent})}}const z=L;const D=e=>[{id:"expander",Header:()=>null,Cell:({row:e})=>o.createElement("span",Object.assign({},e.getToggleRowExpandedProps({style:{paddingLeft:`${e.depth*2}rem`}})),o.createElement(m.FontAwesomeIcon,{icon:e.isExpanded?i.faAngleDown:i.faAngleRight}))},{Header:"Name",accessor:"name",Cell:({row:a})=>o.createElement(c.Link,{to:`${e}/packages/${a.values.name}`},a.values.name)},{Header:"Summary",accessor:"summary"},{Header:"Version",accessor:"current_version",Cell:({row:e})=>e.values.current_version||o.createElement("i",null,"n/a")}];var j;(function(e){e["Info"]="info";e["Packages"]="packages";e["Members"]="members";e["ApiKeys"]="api-keys"})(j||(j={}));class q extends o.PureComponent{constructor(e){var a;super(e);this.setTabId=e=>{this.setState({selectedTabId:e});const a=new URLSearchParams(window.location.search);a.delete("tab");a.delete("index");a.delete("query");a.delete("size");a.append("tab",e);history.pushState(null,"","?"+a.toString())};const t=new URLSearchParams(window.location.search);const n=(a=t.get("tab"))!==null&&a!==void 0?a:"info";this.state={selectedTabId:n!==null&&n!==void 0?n:j.Info}}render(){const{selectedTabId:e}=this.state;const{match:{params:a}}=this.props;const{channelId:t}=a;const n=[{text:"Home",onClick:()=>{this.props.router.navigate("/")}},{text:"Channels",onClick:()=>{this.props.router.navigate("/channels")}},{text:t}];return o.createElement(o.Fragment,null,o.createElement(u.Breadcrumbs,{items:n}),o.createElement("h2",{className:"heading2"},t),o.createElement(p.Tabs,{activeid:`channel-${e}`,onChange:e=>{const a=e.target.activeid;if(typeof a==="string"){this.setTabId(a.slice(8))}}},o.createElement(p.Tab,{id:`channel-${j.Info}`},"Info"),o.createElement(p.Tab,{id:`channel-${j.Packages}`},"Packages"),o.createElement(p.Tab,{id:`channel-${j.Members}`},"Members"),o.createElement(p.Tab,{id:`channel-${j.ApiKeys}`},"API keys"),o.createElement(p.TabPanel,null,o.createElement(P,{channelId:t})),o.createElement(p.TabPanel,null,o.createElement(z,{channelId:t})),o.createElement(p.TabPanel,null,o.createElement(_,{channelId:t})),o.createElement(p.TabPanel,null,o.createElement(N,{channelId:t}))))}}const B=(0,c.withRouter)(q);class K extends o.PureComponent{render(){const{channelId:e,packageId:a}=this.props;return o.createElement("div",{className:"padding"},o.createElement(I,{filters:{channel:e,package:a}}))}}const V=K;class O extends o.PureComponent{render(){const{match:{params:{packageId:e,channelId:a}}}=this.props;const t=h.ServerConnection.makeSettings();const n=d.URLExt.join(t.baseUrl,"/api/channels",a,"/packages",e);return o.createElement("div",{className:"padding jp-table"},o.createElement(u.FetchHoc,{url:n,loadingMessage:"Fetching package information",genericErrorMessage:"Error fetching package information"},(t=>o.createElement(o.Fragment,null,o.createElement("h4",{className:"section-heading"},"Summary"),o.createElement("p",{className:"minor-paragraph"},t.summary||o.createElement("i",null,"n/a")),o.createElement("h4",{className:"section-heading"},"Description"),o.createElement("p",{className:"minor-paragraph"},t.description||o.createElement("i",null,"n/a")),o.createElement(U,{selectedPackage:e,channel:a,showVersionsList:true})))))}}const G=(0,c.withRouter)(O);class W extends o.PureComponent{render(){const{channelId:e,packageId:a}=this.props;const t=h.ServerConnection.makeSettings();const n=d.URLExt.join(t.baseUrl,"/api/channels",e,"/packages",a,"/members");return o.createElement(u.FetchHoc,{url:n,loadingMessage:"Fetching list of members",genericErrorMessage:"Error fetching members list"},(e=>o.createElement("div",{className:"package-files-wrapper padding"},(e||[]).map((e=>o.createElement("div",{className:"list-row",key:e.user.id},o.createElement("div",{className:"member-icon-column"},o.createElement("img",{src:e.user.profile.avatar_url,className:"profile-icon",alt:""})),o.createElement("div",{className:"member-name-column"},e.user.profile.name),o.createElement("div",{className:"member-username-column"},e.user.username),o.createElement("div",{className:"member-role-column"},e.role)))))))}}const J=W;var Q;(function(e){e["Info"]="info";e["Members"]="members";e["ApiKeys"]="api-keys"})(Q||(Q={}));class X extends o.PureComponent{constructor(e){super(e);this.setTabId=e=>{this.setState({selectedTabId:e});history.pushState(null,"",`#${e}`)};const a=(window.location.hash||`#${Q.Info}`).substring(1);this.state={selectedTabId:a!==null&&a!==void 0?a:Q.Info}}render(){const{selectedTabId:e}=this.state;const{match:{params:a}}=this.props;const{channelId:t,packageId:n}=a;const r=[{text:"Home",onClick:()=>{this.props.router.navigate("/")}},{text:"Channels",onClick:()=>{this.props.router.navigate("/channels")}},{text:t,onClick:()=>{this.props.router.navigate(`/channels/${t}`)}},{text:"packages",onClick:()=>{this.props.router.navigate(`/channels/${t}?tab=packages`)}},{text:n}];return o.createElement("div",null,o.createElement(u.Breadcrumbs,{items:r}),o.createElement("h2",{className:"heading2"},t,"/",n),o.createElement(p.Tabs,{activeid:`package-${e}`,onChange:e=>{this.setTabId(e.target.activeid.slice(8))}},o.createElement(p.Tab,{id:`package-${Q.Info}`},"Info"),o.createElement(p.Tab,{id:`package-${Q.Members}`},"Members"),o.createElement(p.Tab,{id:`package-${Q.ApiKeys}`},"API keys"),o.createElement(p.TabPanel,null,o.createElement(G,null)),o.createElement(p.TabPanel,null,o.createElement(J,{channelId:t,packageId:n})),o.createElement(p.TabPanel,null,o.createElement(V,{channelId:t,packageId:n}))))}}const Y=(0,c.withRouter)(X);var Z;(function(e){e.open="@quetz-frontend/channels-extension:open";e.gotoChannels="@quetz-frontend/channels-extension:navigate-to-channels"})(Z||(Z={}));const ee={id:"@quetz-frontend/channels-extension:plugin",autoStart:true,requires:[n.IRouter,l.IMenu],activate:(e,a,t)=>{const{commands:n,shell:r}=e;n.addCommand(Z.open,{label:"Open Channels Panel",execute:()=>{r.add(new te(a),"main")}});n.addCommand(Z.gotoChannels,{label:"Channels",isVisible:()=>t.profile!==null,execute:()=>{a.navigate("/channels")}});a.register({pattern:/^\/channels.*/,command:Z.open});t.addItem({command:Z.gotoChannels,rank:200})}};const ae=ee;class te extends r.ReactWidget{constructor(e){super();this._router=e;this.id=r.DOMUtils.createDomID();this.title.label="Channels main page";this.title.icon=s.fileIcon;this.addClass("jp-ReactWidget")}render(){return o.createElement("div",{className:"page-contents-width-limit"},o.createElement(c.BrowserRouter,{basename:"/channels"},o.createElement(c.Switch,null,o.createElement(c.Route,{path:"/:channelId/packages/:packageId"},o.createElement(Y,{router:this._router})),o.createElement(c.Route,{path:"/:channelId"},o.createElement(B,{router:this._router})),o.createElement(c.Route,{path:"",exact:true},o.createElement(f,{router:this._router})))))}}}}]);