#!/bin/bash -le

# Determine IFO
hostname_=$(hostname -f)
if [[ "${hostname_}" == *"ligo-la"* ]]; then
    IFO="L1"
elif [[ "${hostname_}" == *"ligo-wa"* ]]; then
    IFO="H1"
fi

# Get today's date in YYYYMMDD format
GPSTODAY=$(python -m gwpy.time today)
TODAY=$(python -m gwpy.time -f %Y%m%d ${GPSTODAY})

# Run nagios for low-noise daily data
/home/pulsar/.conda/envs/fscan-py3.10/bin/AnalysisSummary monitor --dag-path /home/pulsar/public_html/fscan/1800s/${IFO}_DMT-ANALYSIS_READY/day/${TODAY}

# Run analysis summary for low-noise data
/home/pulsar/.conda/envs/fscan-py3.10/bin/AnalysisSummary summarize --segtype-path /home/pulsar/public_html/fscan/1800s/${IFO}_DMT-ANALYSIS_READY/ --analysisDuration 1w --analysisEnd now --snapToLast midnight --averageDuration 1day --save-output true

# Run analysis summary for 'all' data
/home/pulsar/.conda/envs/fscan-py3.10/bin/AnalysisSummary summarize --segtype-path /home/pulsar/public_html/fscan/1800s/ALL/ --analysisDuration 1w --analysisEnd now --snapToLast midnight --averageDuration 1day --save-output true
