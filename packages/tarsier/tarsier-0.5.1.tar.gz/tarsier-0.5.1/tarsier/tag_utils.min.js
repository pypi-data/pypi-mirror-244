"use strict";const elIsClean=e=>{const i=e.getBoundingClientRect(),r=e.style?.display==="none"||e.hidden||e.disabled,n=i.width===0||i.height===0,a=e.tagName==="SCRIPT"||e.tagName==="STYLE";return!r&&!n&&!a},inputs=["a","button","textarea","select","details","label"],isInteractable=e=>inputs.includes(e.tagName.toLowerCase())||e.tagName.toLowerCase()==="input"&&e.type!=="hidden"||e.role==="button",text_input_types=["text","password","email","search","url","tel","number"],isTextInsertable=e=>e.tagName.toLowerCase()==="textarea"||e.tagName.toLowerCase()==="input"&&text_input_types.includes(e.type),emptyTagWhitelist=["input","textarea","select","button"],isEmpty=e=>{const i=e.tagName.toLowerCase();if(emptyTagWhitelist.includes(i))return!1;if("innerText"in e&&e.innerText.trim().length===0){const r=e.querySelector("svg"),n=e.querySelector("img");return r||n?!1:isElementInViewport(e)}return!1};function isElementInViewport(e){const i=e.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}function getElementXPath(e){let i=[],r="";for(e&&e.ownerDocument!==window.document&&(r=`iframe[${e.getAttribute("iframe_index")}]`);e;){if(!e.tagName){e=e.parentNode;continue}let n=e.tagName.toLowerCase(),a=1,t=e.previousElementSibling;for(;t;)t.tagName===e.tagName&&a++,t=t.previousElementSibling;let o=e.nextElementSibling,s=!1;for(;o;){if(o.tagName===e.tagName){s=!0;break}o=o.nextElementSibling}if((a>1||s)&&(n+=`[${a}]`),e.id)return n+=`[@id="${e.id}"]`,i.unshift(n),"//"+i.join("/");if(e.className){const l=Array.from(e.classList).map(d=>`contains(concat(" ", normalize-space(@class), " "), " ${d} ")`).join(" and ");l.length>0&&(n+=`[${l}]`)}i.unshift(n),e=e.parentNode}return r+"//"+i.join("/")}function create_tagged_span(e,i){let r;isInteractable(i)?isTextInsertable(i)?r=`[#${e}]`:i.tagName.toLowerCase()=="a"?r=`[@${e}]`:r=`[$${e}]`:r=`[${e}]`;let n=document.createElement("span");return n.id="__tarsier_id",n.style.all="inherit",n.style.display="inline",n.style.color="white",n.style.backgroundColor="red",n.textContent=r,n}window.tagifyWebpage=(e=!1)=>{window.removeTags();let i=0,r={},n=[...document.body.querySelectorAll("*")];const a=document.getElementsByTagName("iframe");for(let t=0;t<a.length;t++)try{const o=a[t];console.log("iframe!",a[t]);const c=[...(o.contentDocument||o.contentWindow?.document).querySelectorAll("*")];c.forEach(l=>l.setAttribute("iframe_index",t)),n.push(...c)}catch(o){console.error("Cross-origin iframe:",o)}n.map(t=>{isInteractable(t)&&t.childNodes.forEach(o=>{const s=n.indexOf(o);s>-1&&n.splice(s,1)})});for(let t of n)if(!(isEmpty(t)||!elIsClean(t))){if(r[i]=getElementXPath(t),isInteractable(t))i++;else if(e)for(let o of Array.from(t.childNodes))o.nodeType===Node.TEXT_NODE&&/\S/.test(o.textContent||"")&&i++}i=0;for(let t of n){if(isEmpty(t)||!elIsClean(t))continue;let o=create_tagged_span(i,t);if(isInteractable(t))isTextInsertable(t)&&t.parentElement?t.parentElement.insertBefore(o,t):t.prepend(o),i++;else if(e){for(let s of Array.from(t.childNodes))if(s.nodeType===Node.TEXT_NODE&&/\S/.test(s.textContent||"")){let c=create_tagged_span(i,t);t.insertBefore(c,s),i++}}}return r},window.removeTags=()=>{document.querySelectorAll("#__tarsier_id").forEach(i=>i.remove())};
