"use strict";const elIsClean=e=>{const i=e.getBoundingClientRect(),s=e.style?.display==="none"||e.hidden||e.disabled,n=i.width===0||i.height===0,r=e.tagName==="SCRIPT"||e.tagName==="STYLE";return!s&&!n&&!r},inputs=["a","button","textarea","select","details","label"],isInteractable=e=>inputs.includes(e.tagName.toLowerCase())||e.tagName.toLowerCase()==="input"&&e.type!=="hidden"||e.role==="button",text_input_types=["text","password","email","search","url","tel","number"],isTextInsertable=e=>e.tagName.toLowerCase()==="textarea"||e.tagName.toLowerCase()==="input"&&text_input_types.includes(e.type),emptyTagWhitelist=["input","textarea","select","button"],isEmpty=e=>{const i=e.tagName.toLowerCase();if(emptyTagWhitelist.includes(i))return!1;if("innerText"in e&&e.innerText.trim().length===0){const s=e.querySelector("svg"),n=e.querySelector("img");return!(s||n)}return!1};function getElementXPath(e){let i=[],s="";for(e&&e.ownerDocument!==window.document&&(s=`iframe[${e.getAttribute("iframe_index")}]`);e;){if(!e.tagName){e=e.parentNode;continue}let n=e.tagName.toLowerCase(),r=1,t=e.previousElementSibling;for(;t;)t.tagName===e.tagName&&r++,t=t.previousElementSibling;let o=e.nextElementSibling,a=!1;for(;o;){if(o.tagName===e.tagName){a=!0;break}o=o.nextElementSibling}if((r>1||a)&&(n+=`[${r}]`),e.id)return n+=`[@id="${e.id}"]`,i.unshift(n),"//"+i.join("/");if(e.className){const c=Array.from(e.classList).map(d=>`contains(concat(" ", normalize-space(@class), " "), " ${d} ")`).join(" and ");c.length>0&&(n+=`[${c}]`)}i.unshift(n),e=e.parentNode}return s+"//"+i.join("/")}function create_tagged_span(e,i){let s;isInteractable(i)?isTextInsertable(i)?s=`[#${e}]`:i.tagName.toLowerCase()=="a"?s=`[@${e}]`:s=`[$${e}]`:s=`[${e}]`;let n=document.createElement("span");return n.id="__tarsier_id",n.style.all="inherit",n.style.display="inline",n.style.color="white",n.style.backgroundColor="red",n.textContent=s,n}window.tagifyWebpage=(e=!1)=>{window.removeTags();let i=0,s={},n=[...document.body.querySelectorAll("*")];const r=document.getElementsByTagName("iframe");for(let t=0;t<r.length;t++)try{const o=r[t];console.log("iframe!",r[t]);const l=[...(o.contentDocument||o.contentWindow?.document).querySelectorAll("*")];l.forEach(c=>c.setAttribute("iframe_index",t)),n.push(...l)}catch(o){console.error("Cross-origin iframe:",o)}n.map(t=>{isInteractable(t)&&t.childNodes.forEach(o=>{const a=n.indexOf(o);a>-1&&n.splice(a,1)})});for(let t of n)if(!(isEmpty(t)||!elIsClean(t))){if(s[i]=getElementXPath(t),isInteractable(t))i++;else if(e)for(let o of Array.from(t.childNodes))o.nodeType===Node.TEXT_NODE&&/\S/.test(o.textContent||"")&&i++}i=0;for(let t of n){if(isEmpty(t)||!elIsClean(t))continue;let o=create_tagged_span(i,t);if(isInteractable(t))isTextInsertable(t)&&t.parentElement?t.parentElement.insertBefore(o,t):t.prepend(o),i++;else if(e){for(let a of Array.from(t.childNodes))if(a.nodeType===Node.TEXT_NODE&&/\S/.test(a.textContent||"")){let l=create_tagged_span(i,t);t.insertBefore(l,a),i++}}}return s},window.removeTags=()=>{document.querySelectorAll("#__tarsier_id").forEach(i=>i.remove())};
