"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[230],{1230:(e,t,n)=>{n.r(t),n.d(t,{Labeled:()=>D,LeafComponentBase:()=>A,LeafComponentDelayedValue:()=>N,LeafComponentInput:()=>L,LeafComponentInputChoices:()=>Z,maintainTableWidth:()=>O,name:()=>T});var a=n(957),i=n(2875),l=n(6042),s=n(5223),r=n(8091),o=n(3424),u=n(4782),p=n(2594),d=n(9840),c=n(9430),h=n(6637),f=n.n(h),m=n(1914),_=n(2972),y=n.n(_),v=n(9281),b=n(1300);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,d.Z)(this,n)}}var W,T="LinoComponentUtils";W={classNames:n.e(473).then(n.t.bind(n,4507,23)),queryString:Promise.all([n.e(473),n.e(521)]).then(n.t.bind(n,5198,19)),prDropdown:Promise.all([n.e(444),n.e(55),n.e(165),n.e(973)]).then(n.bind(n,367)),prInputText:Promise.all([n.e(295),n.e(55),n.e(165)]).then(n.bind(n,8706))};function I(e){e.props.setFocus&&e.inputEl&&(e.inputEl.focus?e.inputEl.focus():e.inputEl.focusInput?e.inputEl.focusInput.focus():e.inputEl.inputRef?e.inputEl.inputRef.current.focus():setTimeout((function(){e.inputEl&&e.inputEl.quill&&e.inputEl.quill.focus()}),200))}function R(e){return function(t){t.data.hasOwnProperty("master_data")&&e.props[b.URL_PARAM_WINDOW_TYPE]!==b.WINDOW_TYPE_TABLE&&Object.keys(t.data.master_data).includes(e.props.elem.name)&&e.setState({value:t.data.master_data[e.props.elem.name]})}}function O(e,t){var n;n=void 0!==e?e:this;var a=Object.keys(n.flexs);(void 0!==t?a.length===t:a.length>1)&&a.forEach((function(e){var t=document.getElementById(e).getElementsByClassName("p-datatable");1===t.length&&((t=t[0]).getBoundingClientRect().width/document.getElementsByClassName("layout-topbar")[0].getBoundingClientRect().width>n.flexs[e]&&Array.from(t.querySelectorAll(".p-datatable table")).forEach((function(e){Array.from(e.classList).join(" ").includes("p-datatable")&&e.style.setProperty("table-layout","auto")})))}))}(0,v.RegisterImportPool)(W);var D=function(e){var t=(0,v.getExReady)(W,["classNames"]),n=e.label||e.elem.label;return t.ready?m.createElement(m.Fragment,null,!e.hide_label&&n&&m.createElement(m.Fragment,null,m.createElement("label",{className:t.classNames.default("l-label",{"l-label--unfilled":!e.isFilled}),title:Object.assign({},e.elem.value||{}).quicktip||e.elem.help_text},n,":"),e.helpText&&m.createElement("span",{style:{float:"right",cursor:"pointer"},title:e.helpText},"?"),m.createElement("br",null)),e.children):null};D.propTypes={label:y().string,elem:y().object.isRequired,hide_label:y().bool,isFilled:y().bool,helpText:y().string,children:y().element.isRequired},D.defaultProps={hide_label:!1,isFilled:!1};var A=function(e){(0,p.Z)(n,e);var t=E(n);function n(e){var a;return(0,r.Z)(this,n),(a=t.call(this,e)).filled=function(){return!["",null,void 0].includes(a.getValue())},a.wrapperClasses=[],a.dataKey=e[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?e.elem.fields_index:e.elem.name,a.filled=a.filled.bind((0,u.Z)(a)),a.getValue=a.getValue.bind((0,u.Z)(a)),a.getValueByName=a.getValueByName.bind((0,u.Z)(a)),a.innerHTML=a.innerHTML.bind((0,u.Z)(a)),a.setLeafRef=a.setLeafRef.bind((0,u.Z)(a)),a}return(0,o.Z)(n,[{key:"getValueByName",value:function(e){return this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_PARAMS?this.context.param_values[e]:this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?this.context.rows[this.props.column.rowIndex][e]:this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_CARDS?this.context[e]:this.context.data[e]}},{key:"getValue",value:function(){return this.getValueByName(this.dataKey)}},{key:"innerHTML",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getValue()||"Â ";return e?m.createElement("div",{style:t,dangerouslySetInnerHTML:{__html:n}}):m.createElement("div",{style:t},n)}},{key:"setLeafRef",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.input,n=void 0!==t&&t,a=e.type,i=void 0===a?"":a;this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_DETAIL&&this.props.urlParams.controller.dataContext.setLeafRef({name:"slave"===i?this.actorID:this.props.elem.name,ref:this,input:n,type:i})}}]),n}(v.Component);A.requiredModules=["classNames"],A.iPool=W,A.contextType=v.DataContextType,A.propTypesFromLinoLayout=(0,l.Z)({column:y().object,editing_mode:y().bool,hide_label:y().bool},b.URL_PARAM_WINDOW_TYPE,y().oneOf([b.WINDOW_TYPE_TABLE,b.WINDOW_TYPE_DETAIL,b.WINDOW_TYPE_CARDS,b.WINDOW_TYPE_GALLERIA,b.WINDOW_TYPE_INSERT,b.WINDOW_TYPE_PARAMS,b.WINDOW_TYPE_UNKNOWN])),A.propTypes=g(g({},A.propTypesFromLinoLayout),{},{elem:y().object.isRequired,tabIndex:y().number.isRequired,urlParams:y().object.isRequired}),A.defaultProps=(0,l.Z)({editing_mode:!1,hide_label:!1},b.URL_PARAM_WINDOW_TYPE,b.WINDOW_TYPE_UNKNOWN);var N=function(e){(0,p.Z)(n,e);var t=E(n);function n(e){var a;return(0,r.Z)(this,n),(a=t.call(this,e)).state=g(g({},a.state),{},{value:null,data_url:null}),a.actorID=e.elem.actor_id||(e.elem.name.includes(".")?e.elem.name:"".concat(e.urlParams.packId,".").concat(e.elem.name)),a.shouldComponentUpdate=a.shouldComponentUpdate.bind((0,u.Z)(a)),a.getData=a.getData.bind((0,u.Z)(a)),a.getValue=a.getValue.bind((0,u.Z)(a)),a.update=a.update.bind((0,u.Z)(a)),a}return(0,o.Z)(n,[{key:"onReady",value:function(){var e=(0,s.Z)((0,c.Z)(n.prototype),"getValue",this).call(this);this.props.urlParams.controller.filled(e)&&(this.delayed=e.hasOwnProperty("delayed_value_url"),this.delayed?(this.setLeafRef({type:"slave"}),this.getData(e.delayed_value_url)):this.setState({value:e}))}},{key:"shouldComponentUpdate",value:function(e,t){return this.delayed?this.state.value!==t.value||null!==this.state.value&&(0,s.Z)((0,c.Z)(n.prototype),"getValue",this).call(this).delayed_value_url!==this.state.data_url:this.state.value!==(0,s.Z)((0,c.Z)(n.prototype),"getValue",this).call(this)}},{key:"componentDidUpdate",value:function(e,t){this.delayed?this.state.data_url!==(0,s.Z)((0,c.Z)(n.prototype),"getValue",this).call(this).delayed_value_url&&(this.setState({value:null}),this.update()):this.setState({value:(0,s.Z)((0,c.Z)(n.prototype),"getValue",this).call(this)})}},{key:"getValue",value:function(){return this.state.value}},{key:"getData",value:function(e){var t=this;this.props.urlParams.controller.actionHandler.silentFetch({path:"".concat(e,"?").concat(this.ex.queryString.stringify(this.props.urlParams.controller.actionHandler.defaultStaticParams()))}).then((function(n){t.setState({value:n.data,data_url:e})}))}},{key:"update",value:function(){this.getData((0,s.Z)((0,c.Z)(n.prototype),"getValue",this).call(this).delayed_value_url)}}]),n}(A);N.requiredModules=["queryString"].concat(A.requiredModules);var L=function(e){(0,p.Z)(s,e);var t,n=E(s);function s(e){var t;return(0,r.Z)(this,s),(t=n.call(this,e)).onKeyDown=function(e){return null},t.styleClasses=["disabled-input","l-card","unsaved-modification"],t.componentWillUnmount=t.componentWillUnmount.bind((0,u.Z)(t)),t.disabled=t.disabled.bind((0,u.Z)(t)),t.filled=t.filled.bind((0,u.Z)(t)),t.focusible=t.focusible.bind((0,u.Z)(t)),t.getCellStyleClasses=t.getCellStyleClasses.bind((0,u.Z)(t)),t.getInput=t.getInput.bind((0,u.Z)(t)),t.onChangeUpdate=t.onChangeUpdate.bind((0,u.Z)(t)),t.onRef=t.onRef.bind((0,u.Z)(t)),t.setCellStyle=t.setCellStyle.bind((0,u.Z)(t)),t.submit=t.submit.bind((0,u.Z)(t)),t.update=t.update.bind((0,u.Z)(t)),t}return(0,o.Z)(s,[{key:"prepare",value:(t=(0,i.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.inputState={inputComponent:this.ex.prInputText.InputText,inputOnly:!1,inputProps:{},onChangeUpdateAssert:function(e){return!0},postOnChange:function(e){return null}},this.focusible()&&I(this),window.addEventListener("message",R(this));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",R(this))}},{key:"disabled",value:function(){if(this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_CARDS)return!0;if(this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_PARAMS)return!1;if(!this.props.elem.editable)return!0;if(this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE){var e=this.context.rows[this.props.column.rowIndex],t=e[e.length-1];return!(!t||!t.meta)&&(!!e[e.length-2]||(e[e.length-3][this.props.elem.name]||!1))}return!!this.context.data.disable_editing||(this.context.data.disabled_fields[this.props.elem.name]||!1)}},{key:"focusible",value:function(){return!!this.props.editing_mode&&(this.props[b.URL_PARAM_WINDOW_TYPE]!==b.WINDOW_TYPE_TABLE&&(!!this.inputEl&&(!this.disabled()&&([null,void 0].includes(this.props.urlParams.focusibleTabIndex)?(this.props.urlParams.focusibleTabIndex=this.props.tabIndex,!0):this.props.tabIndex===this.props.urlParams.focusibleTabIndex))))}},{key:"getCellStyleClasses",value:function(){var e=[];return this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?this.context.modifiedRows[this.props.column.rowIndex].includes(this.props.elem.fields_index)&&e.push("unsaved-modification"):(e.push("l-card"),this.props[b.URL_PARAM_WINDOW_TYPE]!==b.WINDOW_TYPE_CARDS&&(this.disabled()?e.push("disabled-input"):this.context.modified.includes(this.props.elem.name)&&e.push("unsaved-modification"))),e}},{key:"getInput",value:function(){var e=this;return m.createElement(this.inputState.inputComponent,(0,a.Z)({autoFocus:this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE||void 0,onChange:function(t){e.inputState.onChangeUpdateAssert(t)&&(e.onChangeUpdate(t),e.inputState.postOnChange(t))},ref:function(t){e.inputEl=t},style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()||""},this.inputState.inputProps))}},{key:"onChangeUpdate",value:function(e){this.update((0,l.Z)({},this.dataKey,e.target.value)),this.setState({})}},{key:"onRef",value:function(e){var t=this;e&&(this.container=e,this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?this.container=e.closest("td"):this.props[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_DETAIL&&(this.container.onclick=function(e){t.props.editing_mode||t.props.urlParams.controller.history.replaceState({editing_mode:!0})})),this.setCellStyle(this.container)}},{key:"setCellStyle",value:function(e){if(e){var t=this.getCellStyleClasses();this.styleClasses.forEach((function(t){e.classList.remove(t)})),t.forEach((function(t){e.classList.add(t)}))}}},{key:"submit",value:function(){this.props.urlParams.controller.actionHandler.submit({col:this.props.column})}},{key:"update",value:function(e){this.props.urlParams.controller.actionHandler.update({values:e,elem:this.props.elem,col:this.props.column,windowType:this.props[b.URL_PARAM_WINDOW_TYPE]})}},{key:"render",value:function(){return this.state.ready?(this.container&&this.setCellStyle(this.container),m.createElement(D,(0,a.Z)({},this.props,{elem:this.props.elem,isFilled:this.filled()}),m.createElement("div",{className:this.ex.classNames.default(this.wrapperClasses),onKeyDown:this.onKeyDown,ref:this.onRef},this.inputState.inputOnly||this.props.editing_mode&&!this.disabled()?this.getInput():this.innerHTML()))):null}}]),s}(A);L.requiredModules=["prInputText"].concat(A.requiredModules);var Z=function(e){(0,p.Z)(n,e);var t=E(n);function n(e){var a;return(0,r.Z)(this,n),(a=t.call(this,e)).state=g(g({},a.state),{},{hidden_value:null}),a.dataKeyHidden=e[b.URL_PARAM_WINDOW_TYPE]===b.WINDOW_TYPE_TABLE?e.elem.fields_index_hidden:e.elem.name+"Hidden",a.getInput=a.getInput.bind((0,u.Z)(a)),a.getValue=a.getValue.bind((0,u.Z)(a)),a.innerHTML=a.innerHTML.bind((0,u.Z)(a)),a}return(0,o.Z)(n,[{key:"getValue",value:function(){return{text:(0,s.Z)((0,c.Z)(n.prototype),"getValue",this).call(this),value:this.getValueByName(this.dataKeyHidden)}}},{key:"getInput",value:function(){var e=this;return m.createElement("div",{className:"l-ChoiceListFieldElement",style:{margin_top:"1px"}},m.createElement(this.ex.prDropdown.Dropdown,{tabIndex:this.props.tabIndex,style:{width:"100%"},options:this.options,optionLabel:"text",value:this.getValue().value,showClear:this.props.elem.field_options.allowBlank,onChange:function(t){e.update((0,l.Z)((0,l.Z)({},e.dataKey,t.value),e.dataKeyHidden,t.value)),e.setState({})},ref:function(t){return e.inputEl=t}}))}},{key:"innerHTML",value:function(){var e=(0,s.Z)((0,c.Z)(n.prototype),"getValue",this).call(this)||"Â ";return m.createElement("div",{style:{whiteSpace:"nowrap"}},e)}}]),n}(L);Z.requiredModules=["prDropdown"].concat(L.requiredModules)}}]);
//# sourceMappingURL=main.230.1ef7336a57c5909dd9fe.js.map