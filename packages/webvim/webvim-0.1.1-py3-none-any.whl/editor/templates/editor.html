<!DOCTYPE html>
<html lang="en">
<head>
    <title>WebEditor</title>
    <!-- Required meta tags -->
    <meta charset="utf-8"/>
    <link rel="icon" href="{{ url_for('static', filename = 'img/logo.svg') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <!-- Support CodeMirror -->
    <link href="{{ url_for('static', filename = 'css/editor.css') }}" rel="stylesheet"/>

    <link href="{{ url_for('static', filename = 'sweetalert2/sweetalert2.min.css') }}" rel="stylesheet"/>

    <link href="{{ url_for('static', filename = 'codemirror/lib/codemirror.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static', filename = 'codemirror/addon/dialog/dialog.css') }}" rel="stylesheet"/>
    <style>
        .CodeMirror {
          border-top: 1px solid #eee;
          border-bottom: 1px solid #eee;
          height: 600px;
        }
    </style>
</head>
<body>
<div id="nav">
    <a href="#">
        <h1>WebEditor</h1>
        <img width="100px" height="100px" id="logo" src="{{ url_for('static', filename = 'img/logo.svg') }}"/>
    </a>
    <ul>
        {% for nav in nobj %}
        <li><a class="{{ nav.fileStatus }}" href="/?key={{ nav.fileKey }}">{{ nav.fileName }}</a></li>
        {% endfor %}
    </ul>
    <p>
        <button style="margin-right: 10px; width: 70px" id="save" aria-title="Save code">Save</button>
        <br/>
        <button style="margin-right: 10px; width: 70px;margin-top:10px" id="undo" aria-title="undo code">Undo</button>
    </p>
</div>

<article>
    <h2>Web Editor Online - <span style="color:#d30707"><em><strong>{{fobj.fileName}}</strong></em></span></h2>

    <textarea id="code" name="code">{{ fobj.fileContent }}</textarea>

    <section>
        <p style="margin-top: 8px">
            Path: <em>{{ fobj.filePath }}</em>
        </p>
        <input type="hidden" id="key" value="{{ fobj.fileKey }}"/>
    </section>

</article>

<script src="{{ url_for('static', filename = 'codemirror/lib/codemirror.js') }}"></script>
<script src="{{ url_for('static', filename = 'codemirror/mode/clike/clike.js') }}"></script>
<script src="{{ url_for('static', filename = 'codemirror/keymap/sublime.js') }}"></script>
<script src="{{ url_for('static', filename = 'codemirror/addon/edit/matchbrackets.js') }}"></script>
<script src="{{ url_for('static', filename = 'codemirror/addon/comment/comment.js') }}"></script>
<script src="{{ url_for('static', filename = 'codemirror/addon/dialog/dialog.js') }}"></script>
<script src="{{ url_for('static', filename = 'codemirror/addon/search/searchcursor.js') }}"></script>
<script src="{{ url_for('static', filename = 'codemirror/addon/search/search.js') }}"></script>

<script src="{{ url_for('static', filename = 'sweetalert2/sweetalert2.min.js') }}"></script>

<script src="{{ url_for('static', filename = 'js/jquery-3.5.1.min.js') }}"></script>

<script>
    $(document).ready(function(){
        var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
          lineNumbers: true,
          mode: "text/x-csrc",
          matchBrackets: true,
          keyMap: "sublime",
        });

        $("#undo").click(function(){
            editor.undo();
        });

        $("#save").click(function(){
            var content =  btoa(encodeURIComponent(editor.getValue()));
            var key = $("#key").val();
            $.post("/save",{content:content,key:key},function(data,status){
                if(status == 'success') {
                    if(data.code == 1) {
                        Swal.fire({
                            title: "Good job!",
                            icon: "success",
                            width: "22em"
                        });
                    } else {
                        Swal.fire({
                            icon: "error",
                            title: data.message,
                            width: "22em"
                        });
                    }
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "status error",
                        width: "22em"
                    });
                }
            });
        });
    });

</script>
</body>
</html>
